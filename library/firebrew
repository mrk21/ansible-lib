#!/usr/bin/env python
# -*- coding: utf-8 -*-

from ansible.module_utils.basic import *

class Firebrew:
    STATUS_SUCCESS = 0
    STATUS_FAILURE = 1
    STATUS_NOT_CHANGED = 7
    
    def __init__(self, AnsibleModule = AnsibleModule):
        self.module = AnsibleModule(
            argument_spec = dict(
                state = dict(type='str', default='present', choices=['present', 'absent']),
                name = dict(type='str', required=True)
            )
        )
    
    def execute(self):
        firebrew = self.module.get_bin_path('firebrew')
        command = {'present': 'install', 'absent': 'uninstall'}[self.module.params['state']]
        name = self.module.params['name']
        (rc,out,err) = self.module.run_command('%s %s %s' % (firebrew, command, name))
        
        if rc == self.STATUS_SUCCESS:
            self.module.exit_json(changed=True)
        elif rc == self.STATUS_NOT_CHANGED:
            self.module.exit_json(changed=False)
        else:
            self.module.fail_json(msg = err)

if __name__ == '__main__':
    Firebrew().execute()
